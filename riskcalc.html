<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>M-Vita Risk Appetite Calculator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.1/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .brand-blue { color: #2161B5; }
        .bg-brand-blue { background-color: #2161B5; }
        .border-brand-blue { border-color: #2161B5; }
        .form-radio:checked {
            background-image: url("data:image/svg+xml,%3csvg viewBox='0 0 16 16' fill='%232161B5' xmlns='http://www.w3.org/2000/svg'%3e%3ccircle cx='8' cy='8' r='3'/%3e%3c/svg%3e");
            border-color: #2161B5;
        }
        .form-input:focus, .form-radio:focus {
            outline: 2px solid transparent;
            outline-offset: 2px;
            --tw-ring-color: #2161B5;
            box-shadow: 0 0 0 2px #fff, 0 0 0 4px var(--tw-ring-color);
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 300px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 300px;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <div id="app" class="min-h-screen flex flex-col items-center justify-center p-4 sm:p-6 lg:p-8">

        <div class="w-full max-w-2xl mx-auto bg-white rounded-xl shadow-lg overflow-hidden">

            <header class="p-6 bg-gray-100 border-b border-gray-200">
                <div class="flex flex-col sm:flex-row justify-between items-center space-y-4 sm:space-y-0">
                    <div class="flex items-center space-x-3">
                        <img src="M-Vita Name 2.jpg" class="h-10 w-auto" onerror="this.onerror=null; this.src='https://placehold.co/100x40/2161B5/FFFFFF?text=M-Vita';">
                        <h1 class="text-xl sm:text-2xl font-bold brand-blue">Risk Appetite Calculator</h1>
                    </div>
                    <div class="flex items-center space-x-2 sm:space-x-4">
                        <a href="knowledge.html" class="text-sm font-medium text-gray-600 hover:brand-blue transition-colors">Back to Website</a>
                        <a href="https://wa.me/9152049967" target="_blank" class="px-4 py-2 bg-green-500 text-white text-sm font-semibold rounded-lg hover:bg-green-600 transition-colors shadow-sm">Get in Touch</a>
                    </div>
                </div>
            </header>

            <main class="p-6 sm:p-8">
                <div id="step-1">
                    <h2 class="text-2xl font-bold text-gray-800 mb-2">Discover Your Financial Risk Profile</h2>
                    <p class="text-gray-600 mb-6">Let's start with some basic information to personalize your report. This is the first step towards understanding your investment style.</p>
                    <form id="details-form" class="space-y-4">
                        <div>
                            <label for="name" class="block text-sm font-medium text-gray-700">Full Name</label>
                            <input type="text" id="name" name="name" required class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-brand-blue focus:border-brand-blue sm:text-sm">
                        </div>
                        <div>
                            <label for="mobile" class="block text-sm font-medium text-gray-700">Mobile Number</label>
                            <input type="tel" id="mobile" name="mobile" required pattern="[6-9]{1}[0-9]{9}" title="Please enter a valid 10-digit Indian mobile number" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-brand-blue focus:border-brand-blue sm:text-sm">
                        </div>
                        <div class="pt-4">
                            <button type="submit" class="w-full bg-brand-blue text-white font-bold py-3 px-4 rounded-lg hover:opacity-90 transition-opacity focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-brand-blue">Start Assessment</button>
                        </div>
                    </form>
                </div>

                <div id="step-2" class="hidden">
                    <div class="mb-6">
                        <h2 class="text-2xl font-bold text-gray-800 mb-2">Investment Questionnaire</h2>
                        <p class="text-gray-600">Answer the following questions to help us understand your risk tolerance.</p>
                    </div>

                    <div class="w-full bg-gray-200 rounded-full h-2.5 mb-6">
                        <div id="progress-bar" class="bg-brand-blue h-2.5 rounded-full" style="width: 0%"></div>
                    </div>

                    <div id="question-container" class="space-y-6">
                        </div>

                    <div id="nav-buttons-container" class="mt-8 flex justify-end">
                        <button id="back-btn" class="px-6 py-2 bg-gray-200 text-gray-700 font-semibold rounded-lg hover:bg-gray-300 transition-colors">Back</button>
                        <button id="next-btn" class="px-6 py-2 bg-brand-blue text-white font-semibold rounded-lg hover:opacity-90 transition-opacity">Next</button>
                    </div>
                </div>

                <div id="step-3" class="hidden text-center">
                    <h2 class="text-3xl font-bold text-gray-800 mb-2">Your Risk Profile Results</h2>
                    <p class="text-gray-600 mb-6">Based on your answers, here is your personalized risk appetite assessment.</p>

                    <div class="chart-container mb-6">
                        <canvas id="resultChart"></canvas>
                    </div>

                    <div id="result-text" class="mb-8">
                        <p class="text-lg text-gray-600">Your Risk Score:</p>
                        <p id="risk-score" class="text-5xl font-bold brand-blue mb-2"></p>
                        <p id="risk-level" class="text-2xl font-semibold text-gray-700 mb-4"></p>
                        <p id="risk-description" class="max-w-prose mx-auto text-gray-600"></p>
                    </div>

                    <div class="flex flex-col sm:flex-row justify-center gap-4">
                        <button id="view-print-btn" class="w-full sm:w-auto bg-brand-blue text-white font-bold py-3 px-6 rounded-lg hover:opacity-90 transition-opacity">View & Print Report</button>
                        <button id="edit-btn" class="w-full sm:w-auto bg-gray-200 text-gray-700 font-semibold py-3 px-6 rounded-lg hover:bg-gray-300 transition-colors">Edit & Recalculate</button>
                    </div>
                </div>
            </main>
        </div>

        <footer class="w-full max-w-2xl mx-auto mt-6 text-xs text-gray-500 text-left">
            <p class="font-semibold mb-2">Disclaimer:</p>
            <p>Mutual fund investments are subject to market risks, read all scheme related documents carefully. The NAVs of the schemes may go up or down depending upon the factors and forces affecting the securities market including the fluctuations in the interest rates. The past performance of the mutual funds is not necessarily indicative of future performance of the schemes. The Mutual Fund is not guaranteeing or assuring any dividend under any of the schemes and the same is subject to the availability and adequacy of distributable surplus. Investors are requested to review the prospectus carefully and obtain expert professional advice with regard to specific legal, tax and financial implications of the investment/participation in the scheme. This calculator is for informational purposes only and does not constitute financial advice. Registration granted by SEBI does not guarantee performance or provide any assurance of returns to investors.</p>
        </footer>
    </div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    // Check if the Supabase library has loaded
    if (typeof supabase === 'undefined') {
        console.error("Supabase library not loaded. Please check your internet connection and ensure the script from cdn.jsdelivr.net is not blocked.");
        
        const submitButton = document.getElementById('details-form').querySelector('button[type="submit"]');
        if(submitButton) {
            submitButton.disabled = true;
            submitButton.textContent = 'Error: App Could Not Load';
            submitButton.style.backgroundColor = '#999';
        }
        alert("A required library (Supabase) could not be loaded. Please check your internet connection and try again.");
        return;
    }

    // --- SUPABASE SETUP ---
    const SUPABASE_URL = 'https://uyntgocoxdrzdqumlwfe.supabase.co';
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InV5bnRnb2NveGRyemRxdW1sd2ZlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUxNzczMDMsImV4cCI6MjA3MDc1MzMwM30.xWK9IeeJcWqp-gaDR2yO_hqscAsVgbJQ5sxTo2AUvfU';
    const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
    // --- END SUPABASE SETUP ---

    const appState = {
        currentStep: 1,
        currentQuestionIndex: 0,
        userData: {},
        answers: [],
    };

    const questions = [
        { q: "What is your primary objective for this investment?", o: [{t:"Capital Protection", s:1}, {t:"Regular Income", s:2}, {t:"Capital Growth", s:3}, {t:"Aggressive Growth", s:4}] },
        { q: "What is your age group?", o: [{t:"Above 60 years", s:1}, {t:"45 to 60 years", s:2}, {t:"35 to 44 years", s:3}, {t:"34 or younger", s:4}] },
        { q: "How long do you plan to keep your money invested?", o: [{t:"Less than 1 year", s:1}, {t:"1 to 3 years", s:2}, {t:"3 to 5 years", s:3}, {t:"More than 5 years", s:4}] },
        { q: "How would you react to a 20% fall in your portfolio's value?", o: [{t:"Sell all investments", s:1}, {t:"Sell some investments", s:2}, {t:"Hold on to investments", s:3}, {t:"Invest more", s:4}] },
        { q: "How would you describe your knowledge of investments?", o: [{t:"None", s:1}, {t:"Limited", s:2}, {t:"Good", s:3}, {t:"Expert", s:4}] },
        { q: "What proportion of your monthly income can you save?", o: [{t:"Less than 10%", s:1}, {t:"10% to 25%", s:2}, {t:"25% to 50%", s:3}, {t:"More than 50%", s:4}] },
        { q: "How secure is your primary source of income?", o: [{t:"Not secure", s:1}, {t:"Somewhat secure", s:2}, {t:"Secure", s:3}, {t:"Very secure", s:4}] },
        { q: "Which investment have you had the most experience with?", o: [{t:"Bank FDs, Provident Fund", s:1}, {t:"Debt mutual funds, bonds", s:2}, {t:"Equity mutual funds, stocks", s:3}, {t:"Derivatives, Crypto", s:4}] },
        { q: "How much of your portfolio would you comfortably allocate to high-risk assets?", o: [{t:"0-10%", s:1}, {t:"11-25%", s:2}, {t:"26-50%", s:3}, {t:"More than 50%", s:4}] },
        { q: "How do you feel about complex financial products?", o: [{t:"Avoid them completely", s:1}, {t:"Prefer simple products", s:2}, {t:"Willing to learn about them", s:3}, {t:"Comfortable using them", s:4}] },
        { q: "What is your total net worth (excluding primary residence)?", o: [{t:"Up to ₹10 Lakh", s:1}, {t:"₹10 Lakh to ₹50 Lakh", s:2}, {t:"₹50 Lakh to ₹1 Crore", s:3}, {t:"Above ₹1 Crore", s:4}] },
        { q: "How many dependents do you financially support?", o: [{t:"More than 3", s:1}, {t:"2 to 3", s:2}, {t:"1", s:3}, {t:"None", s:4}] },
        { q: "If you won a lottery of ₹10 Lakh, what would you do?", o: [{t:"Put it all in a savings account", s:1}, {t:"Invest mostly in safe assets", s:2}, {t:"Invest in a balanced portfolio", s:3}, {t:"Invest mostly in stocks", s:4}] },
        { q: "How important is immediate access to your invested money?", o: [{t:"Very important", s:1}, {t:"Somewhat important", s:2}, {t:"Not very important", s:3}, {t:"Not important at all", s:4}] },
        { q: "In pursuit of higher returns, I am willing to accept...", o: [{t:"No fluctuations in value", s:1}, {t:"Minor short-term fluctuations", s:2}, {t:"Moderate fluctuations", s:3}, {t:"Significant fluctuations", s:4}] },
        { q: "How do you handle financial decisions?", o: [{t:"I am very cautious and avoid risk", s:1}, {t:"I take calculated risks", s:2}, {t:"I am comfortable with taking risks", s:3}, {t:"I enjoy taking significant risks for high returns", s:4}] },
        { q: "Your existing insurance coverage (life and health) is:", o: [{t:"None or very little", s:1}, {t:"Basic coverage", s:2}, {t:"Adequate coverage", s:3}, {t:"More than adequate coverage", s:4}] },
        { q: "How much debt do you currently have (e.g., loans)?", o: [{t:"High amount of debt", s:1}, {t:"Moderate amount of debt", s:2}, {t:"Low amount of debt", s:3}, {t:"Debt-free", s:4}] },
        { q: "When it comes to investing, I prefer:", o: [{t:"Guaranteed returns, even if low", s:1}, {t:"A mix of safety and some growth", s:2}, {t:"Higher growth, accepting some risk", s:3}, {t:"Maximizing returns, accepting high risk", s:4}] },
        { q: "How would you rate your financial stability?", o: [{t:"Unstable", s:1}, {t:"Somewhat stable", s:2}, {t:"Stable", s:3}, {t:"Very stable", s:4}] }
    ];

    const steps = {
        1: document.getElementById('step-1'),
        2: document.getElementById('step-2'),
        3: document.getElementById('step-3'),
    };

    const detailsForm = document.getElementById('details-form');
    const questionContainer = document.getElementById('question-container');
    const progressBar = document.getElementById('progress-bar');
    const nextBtn = document.getElementById('next-btn');
    const backBtn = document.getElementById('back-btn');
    const editBtn = document.getElementById('edit-btn');
    const viewPrintBtn = document.getElementById('view-print-btn');
    const navButtonsContainer = document.getElementById('nav-buttons-container');
    let resultChart = null;

    const showStep = (stepNumber) => {
        Object.values(steps).forEach(stepEl => stepEl.classList.add('hidden'));
        steps[stepNumber].classList.remove('hidden');
        appState.currentStep = stepNumber;
    };

    const renderQuestion = () => {
        const question = questions[appState.currentQuestionIndex];
        questionContainer.innerHTML = `
            <div class="space-y-4">
                <p class="text-lg font-semibold text-gray-700">${appState.currentQuestionIndex + 1}. ${question.q}</p>
                ${question.o.map((option, index) => `
                    <label class="flex items-center p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer transition-colors">
                        <input type="radio" name="q${appState.currentQuestionIndex}" value="${option.s}" class="h-4 w-4 form-radio text-brand-blue border-gray-300 focus:ring-brand-blue" required ${appState.answers[appState.currentQuestionIndex] == option.s ? 'checked' : ''}>
                        <span class="ml-3 text-gray-700">${option.t}</span>
                    </label>
                `).join('')}
            </div>`;
        updateProgressBar();
        updateNavButtons();
    };
    
    const updateProgressBar = () => {
        const progress = ((appState.currentQuestionIndex + 1) / questions.length) * 100;
        progressBar.style.width = `${progress}%`;
    };

    const updateNavButtons = () => {
        if (appState.currentQuestionIndex === 0) {
            backBtn.classList.add('hidden');
            navButtonsContainer.classList.remove('justify-between');
            navButtonsContainer.classList.add('justify-end');
        } else {
            backBtn.classList.remove('hidden');
            navButtonsContainer.classList.remove('justify-end');
            navButtonsContainer.classList.add('justify-between');
        }
        nextBtn.textContent = appState.currentQuestionIndex === questions.length - 1 ? 'Calculate' : 'Next';
    };

    const calculateRisk = () => {
        const totalScore = appState.answers.reduce((sum, score) => sum + parseInt(score), 0);
        let level, description, implications;
        
        if (totalScore <= 35) {
            level = 'Conservative';
            description = 'You prioritize capital protection and have a low tolerance for market volatility. You prefer safe and stable returns over high growth potential.';
            implications = 'Your profile typically suits a portfolio with a high allocation to debt instruments like government bonds, corporate bonds, and fixed deposits, with minimal exposure to equities.';
        } else if (totalScore <= 50) {
            level = 'Moderate';
            description = 'You seek a balance between risk and return. You are willing to accept a reasonable level of risk to achieve moderate growth on your investments.';
            implications = 'Your profile is generally suitable for a balanced portfolio with a mix of equities and debt instruments. This allows for growth potential while managing downside risk.';
        } else if (totalScore <= 65) {
            level = 'Growth-Oriented';
            description = 'You are willing to take on higher-than-average risk for potentially higher returns. You are focused on long-term growth and can tolerate significant market fluctuations.';
            implications = 'Your profile suggests a portfolio with a higher allocation towards equities and equity-oriented mutual funds, with a smaller portion in debt for diversification.';
        } else {
            level = 'Aggressive';
            description = 'You have a high tolerance for risk and are willing to withstand significant market volatility in pursuit of maximum returns. You likely have a long investment horizon.';
            implications = 'Your profile is suited for a portfolio heavily weighted in equities, including small-cap and mid-cap stocks, and other high-risk, high-return assets.';
        }

        return { totalScore, level, description, implications };
    };

    const displayResults = () => {
        const { totalScore, level, description } = calculateRisk();
        
        document.getElementById('risk-score').textContent = totalScore;
        document.getElementById('risk-level').textContent = level;
        document.getElementById('risk-description').textContent = description;

        const maxScore = questions.length * 4;
        const chartData = {
            datasets: [{
                data: [totalScore, maxScore - totalScore],
                backgroundColor: ['#2161B5', '#e5e7eb'],
                borderWidth: 0,
                borderRadius: 5,
            }],
            labels: ['Your Score', 'Remaining']
        };

        if(resultChart) resultChart.destroy();

        resultChart = new Chart(document.getElementById('resultChart'), {
            type: 'doughnut',
            data: chartData,
            options: {
                responsive: true,
                maintainAspectRatio: false,
                cutout: '70%',
                plugins: {
                    legend: { display: false },
                    tooltip: { enabled: false }
                }
            }
        });
        showStep(3);
    };

    const openPrintWindow = () => {
        const { totalScore, level, description } = calculateRisk();
        const now = new Date();
        const formattedDate = now.toLocaleDateString('en-US', {
            year: 'numeric',
            month: 'long',
            day: 'numeric'
        });

        const printContent = `
            <!DOCTYPE html>
            <html lang="en">
            <head>
                <meta charset="UTF-8">
                <meta name="viewport" content="width=device-width, initial-scale=1.0">
                <title>M-Vita Risk Appetite Report</title>
                <link rel="preconnect" href="https://fonts.googleapis.com">
                <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
                <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
                <style>
                    body { font-family: 'Inter', sans-serif; color: #333; margin: 20px; }
                    .header { text-align: center; border-bottom: 2px solid #2161B5; padding-bottom: 10px; margin-bottom: 20px; }
                    .header img { height: 50px; display: block; margin: 0 auto 5px auto; }
                    .header h1 { color: #2161B5; margin: 0; font-size: 24px; }
                    .header p { margin: 0; color: #666; font-size: 12px; }
                    .section-title { font-size: 18px; color: #2161B5; margin-top: 20px; border-bottom: 1px solid #ccc; padding-bottom: 5px; }
                    .details-table { width: 100%; margin-top: 10px; border-collapse: collapse; }
                    .details-table td { padding: 5px 0; vertical-align: top; }
                    .details-table strong { font-weight: bold; }
                    .result-box { background-color: #f8f9fa; padding: 20px; border-radius: 8px; text-align: center; margin-top: 10px; }
                    .result-box .score { font-size: 48px; font-weight: bold; color: #2161B5; margin: 5px 0; }
                    .result-box .level { font-size: 20px; font-weight: 600; margin: 0 0 10px 0; }
                    .disclaimer { margin-top: 20px; padding-top: 20px; font-size: 10px; color: #666; border-top: 1px solid #eee; }
                    .controls { text-align: center; margin-top: 20px; }
                    .controls button { padding: 10px 20px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; margin: 0 10px; }
                    .print-btn { background-color: #2161B5; color: white; }
                    .close-btn { background-color: #e5e7eb; color: #4b5563; }
                    @media print {
                        .controls { display: none; }
                        body { margin: 0; }
                    }
                </style>
            </head>
            <body>
                <div class="header">
                    <img src="https://storage.googleapis.com/gemini-prod/images/05523910-18e3-4b68-b715-32283a0a6e0c" alt="M-Vita Logo" onerror="this.onerror=null; this.src='https://placehold.co/150x50/2161B5/FFFFFF?text=M-Vita';">
                    <h1>Risk Appetite Report</h1>
                    <p>Generated on: ${formattedDate}</p>
                </div>
                
                <h2 class="section-title">Personal Details</h2>
                <table class="details-table">
                    <tr>
                        <td style="width: 30%;"><strong>Name:</strong></td>
                        <td>${appState.userData.name}</td>
                    </tr>
                    <tr>
                        <td><strong>Mobile:</strong></td>
                        <td>${appState.userData.mobile}</td>
                    </tr>
                </table>
                
                <h2 class="section-title">Your Risk Profile</h2>
                <div class="result-box">
                    <p>Your Risk Score:</p>
                    <p class="score">${totalScore}</p>
                    <p class="level">${level}</p>
                    <p>${description}</p>
                </div>

                <h2 class="section-title">Questionnaire Answers</h2>
                <table class="details-table">
                    ${questions.map((q, index) => {
                        const selectedScore = parseInt(appState.answers[index]);
                        const selectedOption = q.o.find(o => o.s === selectedScore);
                        return `<tr><td style="padding: 10px 0; vertical-align: top;"><p style="margin: 0;"><strong>${index + 1}. ${q.q}</strong></p><p style="margin: 5px 0 0 0;"><strong>Answer:</strong> ${selectedOption.t} (Score: ${selectedScore})</p></td></tr>`;
                    }).join('')}
                </table>
                
                <div class="disclaimer">
                    <p><strong>Disclaimer:</strong></p>
                    <p>Mutual fund investments are subject to market risks, read all scheme related documents carefully. The NAVs of the schemes may go up or down depending upon the factors and forces affecting the securities market including the fluctuations in the interest rates. The past performance of the mutual funds is not necessarily indicative of future performance of the schemes. The Mutual Fund is not guaranteeing or assuring any dividend under any of the schemes and the same is subject to the availability and adequacy of distributable surplus. Investors are requested to review the prospectus carefully and obtain expert professional advice with regard to specific legal, tax and financial implications of the investment/participation in the scheme. This calculator is for informational purposes only and does not constitute financial advice. Registration granted by SEBI does not guarantee performance or provide any assurance of returns to investors.</p>
                </div>
                
                <div class="controls">
                    <button class="print-btn" onclick="window.print()">Print Report</button>
                    <button class="close-btn" onclick="window.close()">Close Window</button>
                </div>
            </body>
            </html>
        `;
        
        const printWindow = window.open('', '_blank');
        if (printWindow) {
            printWindow.document.open();
            printWindow.document.write(printContent);
            printWindow.document.close();
        } else {
            alert('Please allow pop-ups for this site to view the report.');
        }
    };

    const uploadToSupabase = async () => {
        try {
            const { totalScore, level } = calculateRisk();

            const questionnaireData = questions.map((q, index) => {
                const selectedScore = parseInt(appState.answers[index]);
                const selectedOption = q.o.find(o => o.s === selectedScore);
                return {
                    question: q.q,
                    answer: selectedOption ? selectedOption.t : 'N/A',
                    score: selectedScore
                };
            });

            const { data, error } = await supabaseClient
                .from('risk_appetite_reports')
                .insert([{
                    client_name: appState.userData.name,
                    mobile_number: appState.userData.mobile,
                    risk_score: totalScore,
                    risk_profile: level,
                    questionnaire: questionnaireData,
                }]);

            if (error) {
                console.error('Error uploading to Supabase:', error);
            }
        } catch (error) {
            console.error('An exception occurred during the Supabase upload:', error);
        }
    };

    detailsForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const formData = new FormData(detailsForm);
        appState.userData = Object.fromEntries(formData.entries());
        showStep(2);
        renderQuestion();
    });

    nextBtn.addEventListener('click', () => {
        const selectedOption = questionContainer.querySelector(`input[name="q${appState.currentQuestionIndex}"]:checked`);
        if (!selectedOption) {
            alert('Please select an answer.');
            return;
        }
        appState.answers[appState.currentQuestionIndex] = selectedOption.value;

        if (appState.currentQuestionIndex < questions.length - 1) {
            appState.currentQuestionIndex++;
            renderQuestion();
        } else {
            displayResults();
        }
    });

    backBtn.addEventListener('click', () => {
        if (appState.currentQuestionIndex > 0) {
            appState.currentQuestionIndex--;
            renderQuestion();
        }
    });
    
    editBtn.addEventListener('click', () => {
        document.getElementById('name').value = appState.userData.name;
        document.getElementById('mobile').value = appState.userData.mobile;
        appState.currentQuestionIndex = 0;
        appState.answers = [];
        showStep(1);
    });
    
    viewPrintBtn.addEventListener('click', async () => {
        await uploadToSupabase();
        openPrintWindow();
    });

});
</script>
</body>
</html>